{{ header }}{{ column_left }}
<div id="content">
	<div class="page-header">
		<div class="container-fluid">
			<div class="float-end minbuttons"><button type="submit" form="form-show" data-bs-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary" id="save-button"><i class="fa-solid fa-floppy-disk"></i></button>
				<a href="{{ back }}" data-bs-toggle="tooltip" title="{{ button_back }}" class="btn btn-light"><i class="fa-solid fa-reply"></i></a>
				<!--<button type="button" class="onetime"> Onetime </button>-->
			</div>
			<h1>{{ heading_title }}</h1>
			<ol class="breadcrumb">
				{% for breadcrumb in breadcrumbs %}
				<li class="breadcrumb-item"><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
				{% endfor %}
			</ol>
		</div>
	</div>
	<div class="container-fluid">
		<div class="panel panel-default">
			<div class="panel-body">
        
				<ul class="nav nav-tabs" role="tablist" id="top-tabs">
					<li class="nav-item"><a href="#tab-general" data-bs-toggle="tab"  class="nav-link active">{{ tab_general }}</a></li>
				</ul>
				
				<div class="tab-content">
					
					<div class="tab-pane fade show active" id="tab-general" role="tabpanel" aria-labelledby="tab-general">
						
{# ***********************Show form ************#}
						<form action="{{ save }}" method="post" enctype="multipart/form-data" id="form-show" data-oc-toggle="ajax">
							<input type="hidden" name="slideshow_id" id="slideshow_id" value="{{ slideshow_id }}" />
							<fieldset id="f1">
								<legend>Slayt Grubu</legend>

								<div class="row mb-3">
									<label for="input-name" class="col-sm-2 col-form-label"> Group Name</label>
									<div class="col-sm-10">
										<input type="text" name="slider[name]" value="{{ name }}" placeholder="Name" id="input-name" class="form-control" />
									</div>
								</div>

								<div class="row mb-3">
									<label for="input-link" class="col-sm-2 col-form-label">Link</label>
									<div class="col-sm-10">
										<input type="text" name="slider[link]" value="{{ parameters.link }}" placeholder="Link" id="input-link" class="form-control" />
									</div>
								</div>
			                    
			                    <div class="row mb-3">
									<label for="input-type" class="col-sm-2 col-form-label">Type</label>
									<div class="col-sm-10">
										<select class="form-control" name="slider[type]" id="slider-type">
											<option value="1" {% if parameters.type == 1 %} selected="selected" {% endif %} >Master Slider</option>
											<option value="2" {% if parameters.type == 2 %} selected="selected" {% endif %} >Revolution Slider</option>
										</select>
										
									</div>
								</div>
			                    
								<div class="row mb-3">
									<label for="input-status" class="col-sm-2 col-form-label">{{ entry_status }}</label>
									<div class="col-sm-10">
										<div class="input-group">
											<div class="form-check form-switch form-switch-lg">
												<input type="hidden" name="slider[status]" value="0"/>
												<input type="checkbox" name="slider[status]" value="1" id="input-status" class="form-check-input"{% if status %} checked{% endif %}/>
											</div>
										</div>
									</div>
								</div>
								<div class="row mb-3">
									<label class="col-sm-2 col-form-label">{{ start_end_date }}</label>
									<div class="col-sm-10 col-md-4">
										<div class="input-group">
											<input type="text" name="slider[start_date]" value="{{ start_date }}" placeholder="{{ entry_start_date }}" id="input-start-date" class="form-control datetime"/>
											<div class="input-group-text"><i class="fa-regular fa-calendar"></i></div>
										</div>
									</div>
									<label  class="col-sm-2 col-form-label">{{ entry_end_date }}</label>
									<div class="col-sm-10 col-md-4">
										<div class="input-group">
											<input type="text" name="slider[end_date]" value="{{ end_date }}" placeholder="{{ entry_end_date }}" id="input-end-date" class="form-control datetime"/>
											<div class="input-group-text"><i class="fa-regular fa-calendar"></i></div>
										</div>
									</div>
								</div>
								
								<div class="row mb-3">
									<label for="slider-delay" class="col-sm-2 col-form-label">Delay (ms)</label>
									<div class="col-sm-10">
										<input type="text" class="form-control" name="slider[delay]" value="{{ parameters.delay }}" id="slider-delay"/>
									</div>
								</div>
								
								<div class="row mb-3">
									<label for="slider-position" class="col-sm-2 col-form-label">position Mode</label>
									<div class="col-sm-10">
										<select class="form-control" name="slider[position]" id="slider-position">
											{% for key,item in slider_defaults.position %}
											<option value="{{ key }}" {% if position == key %} selected="selected" {% endif %} >{{ item }}</option>
											{% endfor %}
										</select>
									</div>
								</div>
								
								<div class="row mb-3 if s1 {{ position =='1' ? 'notH':'' }}" >
									<label class="col-sm-2 col-form-label">{{ text_layouts }}</label>
									<div class="col-sm-10">
										<select class="form-control" name="slider[layout_id]">
							
											{% for layout in slider_defaults.layouts %}
											<option value="{{ layout.layout_id }}" {% if position == "1" and layout_id == layout.layout_id %}selected="selected"{% endif %}>{{ layout.name }}</option>
											{% endfor %}
										</select>
									</div>
								</div>
								
								<div class="row mb-3 if s3 {{ position =='3' ? 'notH':'' }}">
									<label for="input-link" class="col-sm-2 col-form-label">{{ text_category }}</label>
									<div class="col-sm-10">
										<select class="form-control" name="slider[category_id]">
											{% for category in slider_defaults.categories %}
											<option value="{{ category.category_id }}" {% if position == "3" and position_id == category.category_id %} selected="selected"{% endif %}>{{ category.name }}</option>
											{% endfor %}
										</select>
									</div>
								</div>
								
								<div class="row mb-3 if s2 s3 {{ position in 2..3 ? 'notH':'' }}">
									<label for="input-link" class="col-sm-2 col-form-label">{{ text_position }}</label>
									<div class="col-sm-10">
										<input type="hidden" name="slider[viewpos]" id="slider_viewpos" value="{{ viewpos }}"/>
										<div id="view-pos-body">
										</div>
									</div>
								</div>
								
								<div class="row mb-3">
									<label for="input-link" class="col-sm-2 col-form-label">Width Mode</label>
									<div class="col-sm-10">
										<select class="form-control" name="slider[fullwidth]">
											{% for key,value in slider_defaults.fullwidth %}
											<option value="{{ key }}" {% if parameters.fullwidth == key %}selected="selected"{% endif %}>{{ value }}</option>
											{% endfor %}
										</select>
									</div>
								</div>
								
								<div class="row mb-3">
									<label for="input-link" class="col-sm-2 col-form-label">Slayt Width (px)</label>
									<div class="col-sm-4"><input class="form-control" type="text" name="slider[width]" placeholder="1920" value="{{ parameters.width }}"/></div>
									<label for="input-link" class="col-sm-2 col-form-label">Slayt Width (px)</label>
									<div class="col-sm-4"><input class="form-control" type="text" name="slider[height]" placeholder="1024" value="{{ parameters.height }}"/></div>
								</div>
								
								<div class="row mb-3">
									<label for="input-link" class="col-sm-2 col-form-label">On delay</label>
									<div class="col-sm-10">
										<div class="input-group">
											<div class="form-check form-switch form-switch-lg">
												<input type="hidden" name="slider[stop_on_hover]" value="0"/>
												<input type="checkbox" name="slider[stop_on_hover]" value="1" id="input-status" class="form-check-input"{% if parameters.stop_on_hover %}checked="checked"{% endif %}/>
											</div>
										</div>
									</div>
								</div>
								
								<div class="row mb-3">
									<label for="input-link" class="col-sm-2 col-form-label">Mix Mode</label>
									<div class="col-sm-10">
										<div class="input-group">
											<div class="form-check form-switch form-switch-lg">
												<input type="hidden" name="slider[shuffle_mode]" value="0"/>
												<input type="checkbox" name="slider[shuffle_mode]" value="1" id="input-status" class="form-check-input"{% if parameters.shuffle_mode %}checked="checked"{% endif %}/>
											</div>
										</div>
									</div>
								</div>
								
							</fieldset>
				
							<fieldset id="f2">
								<legend>{{ Appearance }}</legend>
								
								<div class="row mb-3 f2">
									<label for="input-link" class="col-sm-2 col-form-label">Shadow Type</label>
									<div class="col-sm-10">
										<select class="form-control" name="slider[shadow_type]" ms-ifval="0" ms-h="f2">
											{% for key,value in slider_defaults.shadow_types %}
											<option value="{{ key }}" {% if parameters.shadow_type == key %}selected="selected"{% endif %}>{{ value }}</option>
											{% endfor %}
										</select>
									</div>
								</div>
								
								<div class="row mb-3 f2">
									<label for="input-link" class="col-sm-2 col-form-label">Show Timeline</label>
									<div class="col-sm-10">
										<div class="input-group">
											<div class="form-check form-switch form-switch-lg">
												<input type="hidden" name="slider[show_time_line]" value="0"/>
												<input type="checkbox" name="slider[show_time_line]" value="1" id="input-status" class="form-check-input"{% if parameters.show_time_line %}checked="checked"{% endif %}/>
											</div>
										</div>
									</div>
								</div>
								
								<div class="row mb-3 f2">
									<label for="input-link" class="col-sm-2 col-form-label">Timer Position</label>
									<div class="col-sm-10">
										<select class="form-control" name="slider[time_line_position]">
											{% for key,value in slider_defaults.linepositions %}
											<option value="{{ key }}" {% if parameters.time_line_position == key %}selected="selected"{% endif %}>{{ value }}</option>
											{% endfor %}
										</select>
									</div>
								</div>
								
							</fieldset>
							
							<fieldset id="f3">
								<legend>{{ Navigator }}</legend>
								
								<div class="row mb-3">
									<label class="col-sm-2 col-form-label">Arrow</label>
									<div class="col-sm-10">
										<select class="form-control" name="slider[navigator_arrows]">
								
											{% for key,value in slider_defaults.navigation_arrows %}
											<option value="{{ key }}" {% if parameters.navigator_arrows == key %}selected="selected"{% endif %}>{{ value }}</option>
											{% endfor %}
										</select>
									</div>
								</div>
								
								<div class="row mb-3">
									<label class="col-sm-2 col-form-label">Navigator Type</label>
									<div class="col-sm-10">
										<select class="form-control" name="slider[navigator_type]" ms-ifval="none" ms-h="f3">
											{% for key,value in slider_defaults.navigator_types %}
											<option value="{{ key }}" {% if parameters.navigator_type  == key %} selected="selected" {% endif %}>{{ value }}</option>
											{% endfor %}
										</select>
									</div>
								</div>
								
								<div class="row mb-3">
									<label class="col-sm-2 col-form-label">Navigation Style</label>
									<div class="col-sm-10">
										<select class="form-control" name="slider[navigation_style]">
											{% for key,value in slider_defaults.navigation_style %}
											<option value="{{ key }}" {% if parameters.navigation_style == key %} selected="selected" {% endif %}>{{ value }}</option>
											{% endfor %}
										</select>
									</div>
								</div>
								
								<div class="row mb-3 f3">
									<label class="col-sm-2 col-form-label">Offset Horizontal (px)</label>
									<div class="col-sm-3 col-md">
										<input class="form-control" type="text" value="{{ parameters.width }}" name="slider[offset_horizontal]"/>
									</div>
									<label class="col-sm-2 control-label">Offset Vertical (px)</label>
									<div class="col-sm-3">
										<input class="form-control" type="text" value="{{ parameters.height }}" name="slider[offset_vertical]"/>
									</div>
								</div>
								
								<div class="row mb-3 f3">
									<label class="col-sm-2 col-form-label">Show Navigator</label>
									<div class="col-sm-10">
										<div class="input-group">
											<div class="form-check form-switch form-switch-lg">
												<input type="hidden" name="slider[show_navigator]" value="0"/>
												<input type="checkbox" name="slider[show_navigator]" value="1" id="input-status" class="form-check-input"{% if parameters.show_navigator %}checked="checked"{% endif %}/>
											</div>
										</div>
									</div>
								</div>
								
								<div class="row mb-3 f3">
									<label class="col-sm-2 col-form-label">Hide Navigator After (ms)</label>
									<div class="col-sm-10">
										<input class="form-control" type="text" value="{{ parameters.hide_navigator_after }}" name="slider[hide_navigator_after]"/>
									</div>
								</div>
								
							</fieldset>
							
							<fieldset id="f4" class="f3">
								<legend>{{ Thumbnails }}</legend>
								
								
								<div class="row mb-3 f3">
									<label class="col-sm-2 col-form-label">Thumbnail Width (px)</label>
									<div class="col-sm-3 col-md">
										<input class="form-control" type="text" value="{{ parameters.thumbnail_width }}" name="slider[thumbnail_width]"/>
									</div>
									<label class="col-sm-2 control-label">Thumbnail Width (px)</label>
									<div class="col-sm-3">
										
									</div>
								</div>
								
								<div class="row mb-3 f3">
									<label class="col-sm-2 col-form-label">Thumbnail Amount</label>
									<div class="col-sm-10">
										<input class='form-control' type="text" value="{{ parameters.thumbnail_amount }}" name="slider[thumbnail_amount]"/>
									</div>
								</div>
								
							</fieldset>
							
							<fieldset id="f5">
								<legend>Mobile Visiblity</legend>
								
								<div class="row mb-3">
									<label class="col-sm-2 col-form-label">Hide Screen Width (px)</label>
									<div class="col-sm-10">
										<input class="form-control" type="text" value="{{ parameters.hide_screen_width }}" name="slider[hide_screen_width]"/>
									</div>
								</div>
							</fieldset>
										
						</form>	
          	
						<script type="text/javascript">
							function byIf(){
								$('[ms-ifval]').each(function(i){
										var qry=$(this).attr('ms-ifval');
										var h=$(this).attr('ms-h');
		
										if($(this).val()==qry){
											if(!$('.'+h).hasClass('hidden')){
												$('.'+h).addClass('hidden')
											}
										}else{
											$('.'+h).removeClass('hidden')
										}
									});
							}

							function getViewContent(categoryID,sc){
								if(categoryID){
									if(sc!='') {
										sData='category_id=' + categoryID+'&th='+ tHeight+'&sc='+sc;
									}else {
										sData='category_id=' + categoryID+'&th='+ tHeight;
									}
			
								}else{
									if(sc!='') {
										sData = 'addcategory=mpage'+'&th='+ tHeight+'&sc='+sc;
									}else{
										sData = 'addcategory=mpage'+'&th='+ tHeight;
									}
								}
								var lgid=$('#slideshow_id').val();
								$.ajax({
										url:'index.php?route=bytao/slideshow.prepos&user_token={{ user_token }}&slideshow_id='+lgid ,
										type: 'post',
										data: sData,
										dataType: 'json',
										success: function(j) {
											if(j['v']){
												$('#view-pos-body').html(j['v']);
												if($('#view-pos-body .active').length>0){
													$('#view-pos-body').animate({
															scrollTop: $('#view-pos-body .active').parents('sort-order-content').offset().top
														}, 2000);
												}
				
											}
										}
									});
	
							}

							byIf();
							$( document ).ready( function(){
									$('#slider-position').trigger('change');
									
									$('.p{{ position }}.slider-positions').removeClass('hidden');
									
									{% if ( position =='3') and ( position_id !='0') %}
									{% if viewpos %}
									getViewContent('{{ position_id }}','{{ viewpos }}');
									{% else %}
									getViewContent('{{ position_id }}',"");
									{% endif %}
									{% endif %}
	
									{% if  position == '2' %}
									{% if viewpos %}
									getViewContent("",'{{ viewpos }}');
									{% else %}
									getViewContent("","");
									{% endif %}
									{% endif %}
								});


							$(document).on('click','[data-so]',function(){
	
									var sel= $(this).data('so');
									$('#slider_viewpos').val(sel);
	
									switch($('#slider-position').val()){
										case '1':   
											break;
										case '2':  
											getViewContent("",sel);
											break;
										case '3': 
											getViewContent($('[name="category_id').val(),sel);
											break;
									}
								});

							$(document).on('change','#slider-position',function(){
									var pos = $(this).val();
									$('.notH').removeClass('notH');
									$('.if.s'+pos).addClass('notH');
									
								});

							$(document).on('change','[name="category_id"]',function(){
									getViewContent($(this).val(),'');
								});

							$(document).on('change','[ms-ifval]',function(){
									byIf();
								})

						</script>

					</div>
				</div>
          
        
			</div>
		</div>
	</div>
	

  
</div>

<div id="modalWindow" class="modal">
	<div id="filemanager" class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{{ heading_title }}</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body" id="modalBody">></div>
			<div class="modal-footer">
				<button type="button" id="btnSave" class="btn btn-primary" title="Save changes"><i class="fa fa-floppy-o"></i></button>
			</div>
		</div>
	</div>
</div>

<div id="dialog-video-manage" class="modal">
	<div id="videomanager" class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Video Yöneticisi</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<table class="table">
					<tr>
						<td>{{ video_type }}</td>
						<td>
							<select class="form-control" name="layer_video_type" id="layer_video_type">
								<option value="youtube">Youtube</option>
								<option value="vimeo">Vimeo</option>
							</select>	
						</td>
					</tr>
					<tr>
						<td>Video ID</td>
						<td><input class="form-control" name="layer_video_id" type="text" id="dialog_video_id">
							<p>örneğin youtube: <b>VA770wpLX-Q</b> ve vimeo: <b>17631561</b> </p>
						</td>
					</tr>
					<tr>
						<td colspan="2">
							<label>{{ Height }}</label>
							<input class="form-control" name="layer_video_height" type="text" value="200">
							<label>{{ Width }}</label>
							<input class="form-control" name="layer_video_width" type="text" value="300">
						</td>
					</tr>
					<tr>
						<td colspan="2">
							<input type="hidden" name="layer_video_thumb" id="layer_video_thumb">
							<div class="buttons">
								<a class="btn btn-primary layer-find-video">Video bul</a>
								<a class="btn btn-success layer-apply-video" id="apply_this_video" style="display:none;">Bu Videoyu Kullan</a>
							</div>
						</td>
					</tr>	
				</table>
				<div id="video-preview"></div>

			</div>
			<div class="modal-footer">
				<button type="button" id="apply_this_video" class="btn btn-primary" title="Bu videoyu kullan"><i class="fa fa-floppy-o"></i></button>
			</div>
		</div>
	</div>
</div>
											
<div id="previewModal" class="modal">
	<div id="filemanager" class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{{ text_preview_sliders_in_group }}</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body"></div>
			<div class="modal-footer">
				<button type="button" id="btnSave" class="btn btn-primary" title="Save changes"><i class="fa fa-floppy-o"></i></button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript"><!--

	var confirm_delete="{{ text_confirm_delete }}";
	var clone_this="{{ text_clone_this }}";
	var delete_this="{{ text_delete_this }}";
	var delete_text="{{ button_delete }}";
	var clone_text="{{ button_clone }}";
	var status_text="{{ text_status }}";
	var noselected_text="{{ text_noselected }}";
	var placeholder="{{ placeholder }}";
	var sSrc="{{ slider_image_src }}";
	var tHeight ="{{ thumbHeight }}"
	var img_url ="{{ img_url }}";
	var h_edit="{{ text_edit_slider }}";
	var h_creat = "{{ text_create_new }}"
	//-->
</script> 

<script type="text/javascript">
	;!function(e){e.fn.classes=function(t){var n=[];e.each(this,function(e,t){var r=t.className.split(/\s+/);for(var i in r){var s=r[i];if(-1===n.indexOf(s)){n.push(s)}}});if("function"===typeof t){for(var r in n){t(n[r])}}return n}}(jQuery);

	var byS = {
		ajaxURL:'index.php?route=bytao/slideshow.ajaxGet&user_token={{ user_token}}',
		lId:0, // language_id,
		state:false,
		data : null,
		Layers : null, 
		currentLayer : null,
		currentSlide:0,
		currentDevice:1,
		activeLayer:0,
		maxId:0,
		countItem : 0,
		delayTime : 9000,
		siteURL : '',
		'setOP':function(OPT){
			
			htmlE = '<div id="langModal" class="modal">';
			htmlE += '	<div id="filemanager" class="modal-dialog modal-lg">';
			htmlE += '		<div class="modal-content">';
			htmlE += '		  <div class="modal-header">';
			htmlE += '		    <h5 class="modal-title">{{ heading_title }}</h5>';
			htmlE += '		    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>';
			htmlE += '		  </div>';
			htmlE += '		  <div class="modal-body">';
			htmlE += '		  <ul>';
			{% for language in languages %}
			htmlE += '				<li id="L{{ language.language_id }}" lid="{{ language.language_id }}" class="{% if loop.first %} active{% endif %}"><img src="{{ language.image }}" title="{{ language.name }}" /> {{ language.name }}</li>';
			{% endfor %}
			htmlE += '		  </ul>';
			htmlE += '		  </div>';
			htmlE += '		  <div class="modal-footer">';
			htmlE += '		  <input type="hidden" id="moveSlaytId" value="">';
			htmlE += '    		<button type="button" id="updateL" class="btn btn-primary" title="Save changes"><i class="fa fa-floppy-o"></i></button>';
			htmlE += '		  </div>';
			htmlE += '		</div>';
			htmlE += '	</div>';
			htmlE += '</div>';
			
			$('body').append(htmlE)
			
			byS.lId =  $('.slide-lang.active').data('lid');
			$('body').append('<div class="hidden" id="arr"></div>')
			
			if(OPT['lId']) byS.lId = OPT['lId'];
			
			$(document).on('click','.layer-style-item a',function(e){
					e.preventDefault();
					tClass = $(this).attr('ms-class');
					$('#input-layer-class-'+byS.lId).val(tClass);
					byS.currentLayer.addClass( tClass );
					$(this).parents('.btn-group').removeClass('open');
					byS.storeCurrentLayerData(); 
					return false;
				});
		
			$(document).on('click','.btn-create',function(e){
					byS.maxId ++ ;
					var layer = byS.createLayer( $(this).attr("data-action"), null, byS.maxId );
				})
		
			$(document).on('click','.btn-delete',function(e){
					//$(this).data('action')
					byS.deleteCurrentLayer();
				});
		
			$(document).on('click','.layer-delete',function(e){
					byS.deleteCurrentLayer();
				});
			
			$(document).on('click','.slider-change-language',function(e){
					e.preventDefault();
					$('#moveSlaytId').val($(this).parent().data('id'))
					$('#langModal ul li').removeClass('active');
					$('#langModal [lid="'+byS.lId+'"]').addClass('active');
					$('#langModal').modal('show');
			});
			
			$(document).on('click','#langModal li',function(e){
					$('#langModal ul li').removeClass('active');
					$(this).addClass('active');
			});
			
			$(document).on('click','#updateL',function(e){
					lang = $('#langModal li.active').attr('lid');
					layerId = $('#moveSlaytId').val();
					$.ajax({
						url: 'index.php?route=bytao/slideshow.movelang&layer_id='+layerId+'&lang='+lang+'&user_token={{ user_token }}' ,
						dataType: 'json',
						success: function(resp) {
							if(resp['error']){
								alert(resp['error']);
							}else{
								$('#slider-item-'+layerId).appendTo('#group-sliders-'+lang)
								$('#group-sliders-'+lang).removeClass('active');	
							}
							$('#langModal').modal('hide');
						}	
					});
					
					
			});
			
			$(document).on('click','.slider-clone',function(e){
					e.preventDefault();
					byS.lId =  $('.slide-lang.active').data('lid');
					if($('#group-sliders-'+byS.lId+' .slider-item.active').length>0){
						layerId=$(this).data('layer_id');
						$.ajax({
								url: 'index.php?route=bytao/slideshow.lyclone&layer_id='+layerId+'&lang='+byS.lId+'&user_token={{ user_token }}',
								dataType: 'json',
								success: function(resp) {
									if(resp['error']){
										alert(resp['error']);
									}
									if( resp['newlayer'] ){
										$('#group-sliders-'+byS.lId+' .new-slider-item').after('<div class="slider-item" data-id="'+resp['newlayer'] +'" id="slider-item-'+resp['newlayer'] + '" > <a class="image" href="#" data-layer_id="'+resp['newlayer'] +'"><img class="slayt-img-responsive" src="'+resp['thumbnail'] +'" height="86"/></a><a  title="'+clone_this+'" class="slider-clone" href="#" data-layer_id="'+resp['newlayer'] +'"><span>'+clone_text+'</span></a><a  title="'+delete_this+'" class="slider-delete" href="#" data-layer_id="'+resp['newlayer'] +'"><span>'+delete_text+'</span></a><a class="slider-status" href="#" data-layer_id="'+resp['newlayer'] +'"><span>'+status_text+'</span></a><div>'+resp['slider_title']+'</div></div>');
										byS.newSlide();
									}
								}	
							});
					}
					else
					{
						alert(noselected_text)
					}

				});
		
			$(document).on('click','.slider-top-clone',function(e){
					e.preventDefault();
					if($('#group-sliders-'+byS.lId+' .slider-item.active').length>0){
						layerId = byS.currentSlide;
						$.ajax({
								url: 'index.php?route=bytao/slideshow.lyclone&layer_id='+layerId+'&lang='+byS.lId+'&user_token=' + getURLVar('user_token'),
								dataType: 'json',
								success: function(resp) {
									if(resp['error']){
										alert(resp['error']);
									}
									if( resp['newlayer'] ){
										$('#group-sliders-'+byS.lId+' .new-slider-item').after('<div class="slider-item" data-id="'+resp['newlayer'] +'" id="slider-item-'+resp['newlayer'] + '" > <a class="image" href="#" data-layer_id="'+resp['newlayer'] +'"><img class="slayt-img-responsive" src="'+resp['thumbnail'] +'" height="86"/></a><a  title="'+clone_this+'" class="slider-clone" href="#" data-layer_id="'+resp['newlayer'] +'"><span>'+clone_text+'</span></a><a  title="'+delete_this+'" class="slider-delete" href="#" data-layer_id="'+resp['newlayer'] +'"><span>'+delete_text+'</span></a><a class="slider-status" href="#" data-layer_id="'+resp['newlayer'] +'"><span>'+status_text+'</span></a><div>'+resp['slider_title']+'</div></div>');
										byS.newSlide();
									}
								}	
							});
					}
					else
					{
						alert(noselected_text)
					}
			
				})
		
			//slayt background image change
			$(document).on('click','.btn-update-slider',function(e){
					e.preventDefault();
					byS.lId =  $('.slide-lang.active').data('lid');
			
					$('#modal-image').remove();
					$.ajax({
							url: 'index.php?route=common/filemanager&user_token={{ user_token }}&target=slider_image_'+byS.lId+ '&simage=slider_image_src_'+byS.lId,
							dataType: 'html',
							success: function(html) {
								$('body').append(html);
								var element = document.querySelector('#modal-image');
								var modal = new bootstrap.Modal(element);
								modal.show();
							}	
						});
				})
		
			//image layer change image
			$(document).on('click','.btn-change-img',function(e){
					layerID = $(this).parents('.draggable-item').attr('lid')
					$('#img_slayerID'+layerID).replaceWith('<img src="" alt="" id="img_slayerID'+layerID + '" />');
					byS.showDialogImage(layerID);
				})
			
			//videomanager
			$(document).on('click','.btn-change-video',function(e){
					$("#dialog-video-manage").show();	
					byS.processDialogVideo('');
				})
			
			$(document).on('click','.layer-find-video',function (){
					if( $(this).parents('#videomanager').find("#dialog_video_id").val() ){
						byS.processDialogVideo( $(this).parents('#videomanager').find("#dialog_video_id").val() );	
					}
					else {  
						$("#video-preview").html( '<div class="error">Could not find any thing</div>' );
					}
		    	
				});
		
			$(document).on('click','.btn-save-slider',function(e){
					byS.submitForm();
				});
		
			$(document).on('click','.btn-preview-slider',function(e){
			
					$('#previewModal .modal-dialog').css('width',1170);
					var a = $( '<span class="glyphicon glyphicon-refresh"></span><iframe frameborder="0" scrolling="no" src="'+$(this).attr('href')+'" style="width:100%;height:500px; display:none"/>'  );
					$('#previewModal .modal-body').html( a );
				
					$('#previewModal').modal('show');
					$('#previewModal').attr('rel', $(this).attr('rel') );
					$(a).load( function(){  
							$('#previewModal .modal-body .glyphicon-refresh').hide();
							$('#previewModal .modal-body iframe').show();
						});
					return false;
				});
		
			$(document).on('click','.slider-item .image',function(e){
					e.preventDefault();
					byS.getSlide($(this).data('layer_id'));
			
				});
		
			$(document).on('click','.slider-new',function(e){
					e.preventDefault();
					$(this).parent().addClass('active');
					byS.newSlide();
				});
			
			$(document).on('click','.onetime',function(e){
				/*$.ajax({
					url: byS.ajaxURL,
					type: 'post',
					data: 't=U' ,
					dataType: 'json',
					success: function(JSON) {
						if(JSON['reload']){
							location=location;
						}
					}
				});*/
			});
				
			$(document).on('click','.slider-status',function(e){
					e.preventDefault();
					var status=0;
					if($(this).hasClass('slider-status-off')){
						$(this).removeClass('slider-status-off');
						status=1;
					}else{
						$(this).addClass('slider-status-off');
					}
					var layerID = $(this).parent().data('id');
					
					$.ajax({
							url: 'index.php?route=bytao/slideshow.savestatus&layer_id='+layerID+'&status='+status+'&user_token=' + getURLVar('user_token'),
							dataType: 'json',
							success: function(RES) {
								if(layerID == byS.currentSlide){
									if(status){
										$('#input-slayt-status-'+byS.lId).prop( "checked", true );
									}else{
										$('#input-slayt-status-'+byS.lId).prop( "checked", false );
									}
								}
						
							}	
						});
						
						
				});

			$(document).on('click','.inGroup',function(e){
					if($( this ).prop( "checked" )){
						$('#'+$(this).attr('ms-elem')).show();
					}else{
						$('#'+$(this).attr('ms-elem')).hide();
					}
				});
		
			$(document).on('click','.slider-delete',function(e){
					e.preventDefault();
					var layerId=$(this).data('layer_id');
			
					if(confirm(confirm_delete)){
				
						$.ajax({
								url: 'index.php?route=bytao/slideshow.lydelete&layer_id='+layerId+'&user_token={{ user_token }}',
								dataType: 'json',
								success: function(RES) {
									if(RES['success']){
										if($('#slider-item-'+RES['success']).hasClass('active')){
											$('#slider-item-'+RES['success']).remove();
											byS.newSlide();
										}else{
											$('#slider-item-'+RES['success']).remove();
										}
							
							
									}
								}	
							});
					}
				});
		
			$(document).on('slidechange','.layer-active .slider-timing', function(e){
					byS.storeCurrentLayerData(); 
				}); 
		
			$(document).on('click', ".btn-clear-pos",function(){
					byS.lId =  $('.slide-lang.active').data('lid');
					if(byS.currentLayer){
						byS.currentLayer.removeClass('pos'+$('.layer-align-table .active').data('h')+$('.layer-align-table .active').data('v'))
						$('#layer-form-'+ byS.lId +' [name="layer_pos_v"]' ).val( 'top');
						$('#layer-form-'+ byS.lId +' [name="layer_pos_h"]' ).val( 'left');
						
						$('.layer-align-table .active').removeClass('active');
						byS.currentLayer.css( 'left','1px');
						byS.currentLayer.css( 'top','1px');
						posId = $('.pos-view.active .layer-align-table','#layer-form-'+byS.lId ).attr('tib');
						$( '[name="layer_top"]','#layer-form-'+byS.lId ).val(1);
						$( '[name="layer_left"]','#layer-form-'+byS.lId ).val(1);
						
						byS.storeCurrentLayerData();
					}
				});
		
			$(document).on('click',".layer-align-table span", function(){
					if(!$(this).hasClass('active')){
						$(this).parents('.layer-align-table').find('.active').removeClass('active');
						$(this).addClass('active');
						
						posId = $(this).parents('.layer-align-table').attr('tib');
						var dataH = $(this).attr('data-h');
						var dataV = $(this).attr('data-v');
						var AddClss = 'pos-'+dataH+'-'+dataV;
						
						$('#slider-editor-'+byS.lId+' .layer-active').addClass(AddClss);
						$('#layer_hpos'+byS.lId).val(dataH)
						$('#layer_vpos'+byS.lId).val(dataV)
						
						byS.setPosition(1,1,dataH,dataV,byS.currentLayer,'changePosition');
						byS.storeCurrentLayerData(); 
					}
				
				});
		
			$(document).on('click',".btn-clear-style", function(){
					byS.lId =  $('.slide-lang.active').data('lid');	
					$("#layer-editor-" + byS.lId+" .draggable-item.layer-active").removeClass($('#input-layer-class-'+byS.lId).val());
					$('#input-layer-class-'+byS.lId).val('');
					//$("#layer-editor-" + byS.lId+".draggable-item.layer-active").classes(function(c) {});
			
					byS.storeCurrentLayerData(); 
				});	
		
			$(document).on('click',".layer-index .status", function(){	
					if($(this).find('i').hasClass('fa-eye')){
						$(this).find('i').removeClass('fa-eye').addClass('fa-eye-slash');
						byS.currentLayer.hide();
					}else{
						$(this).find('i').removeClass('fa-eye-slash').addClass('fa-eye');
						byS.currentLayer.show();
					}
				});	
		
			$(document).on('change keyup paste',".fon input", function(){
				//alert($(this).attr('name'));
			});
			
			$(document).on('change keyup paste',".layer_caption", function(){
					dataFor=$(this).attr('data-for');	
					$( '[name="layer_caption"]','#layer-form-'+ byS.lId ).val($(this).val());
					$("#layer-editor-" + byS.lId+" .layer-active  ."+dataFor).html($(this).val());
					byS.storeCurrentLayerData();
			});	

			$(document).on('shown.bs.tab','#languagetabs a[data-toggle="tab"]', function (e) {
					byS.lId =  $('.slide-lang.active').data('lid');
				});
				
			$("#layer-editor-" + byS.lId).attr('data-icount',$("#layer-editor-" + byS.lId+".draggable-item").length);
		
			$('#timeline-'+ byS.lId).parent().find('.t-end').html(byS.delayTime+'ms');
		
			$('#timeline-'+ byS.lId).slider( {range: true,min: 0,max: byS.delayTime,values: [ 0 , byS.delayTime   ],	
					slide: function( event, ui ) {
						$('#layer_start_time').val(ui.values[ 0 ])
						$('#layer_end_time').val(ui.values[ 1 ])
					}
				} ); 
		}
		,
		'getSlide': function(slide_id){
			
			byS.lId =  $('.slide-lang.active').data('lid');
			var slideshowId =  $('#slideshow_id').val();
			$.ajax({
					url: byS.ajaxURL,
					type: 'post',
					data: 'slideshow_id=' + slideshowId + '&slide_id=' + slide_id + '&t=s&a=g&lang=' + byS.lId ,
					dataType: 'json',
					success: function(j) {
						byS.currentSlide = slide_id;
						byS.getCurrentSlideCount(slide_id);
						var list  = j['params'] ;
						if( list ) {
							byS.deleteLayers();
							$.each(list, function (key, sValue) {
					   
									switch(key){
										case 'slide_title':
												$('#heading'+byS.lId).find('button').html(sValue);
												$('#'+key+'-'+byS.lId).val(sValue);
												break;
										case 'slide_group_id':
											layersliderGroupId = $('#slideshow_id').val();
											$('#'+key+'-'+byS.lId).val(layersliderGroupId);
											break;
										
										case 'slider_status':
												if(sValue=='1'){
													$('input[type="checkbox"][name="'+key+'"]' ).prop( "checked", true );
												}else{
													$('input[type="checkbox"][name="'+key+'"]' ).prop( "checked", false );
												}
												break;
										case 'slider_enable_link':
											if(sValue=='1'){
													$('input[type="checkbox"][name="'+key+'"]' ).prop( "checked", true );
												}else{
													$('input[type="checkbox"][name="'+key+'"]' ).prop( "checked", false );
												}
												break;
										case 'slider_videoplay':
												if(sValue=='1'){
													$('input[type="checkbox"][name="'+key+'"]' ).prop( "checked", true );
												}else{
													$('input[type="checkbox"][name="'+key+'"]' ).prop( "checked", false );
												}
												break;
										case 'slider_thumbnail':
												$('#'+key+'-'+byS.lId).val(sValue);
												if(sValue!=''){
													$('#'+key+'-'+byS.lId).parents('.image').find('img').attr('src',img_url+sValue)
												}else{
													$('#'+key+'-'+byS.lId).parents('.image').find('img').attr('src',placeholder);
												}
												break;
										case 'slider_image':
												$('#'+key+'_'+byS.lId).val(sValue);
												if(sValue!=''){
													$('#slider_image_src_'+byS.lId).attr('src',img_url + sValue)
												}
												break;
										default:
												$('#'+key+'-'+byS.lId).val(sValue);
									}
					   
								});
						}
						$('.bytao-switch-btn input[type=checkbox]').each(function(e){
								if($( this ).prop( "checked" )){
									$('#'+$(this).attr('ms-elem')).show();
								}else{
									$('#'+$(this).attr('ms-elem')).hide();
								}
							});
						$('#tab-lang-' + byS.lId + ' .slider-top-clone ').removeClass('hidden');
						$('#group-sliders-' + byS.lId + ' > div.active ').removeClass('active');
						$('#group-sliders-' + byS.lId + ' > #slider-item-'+slide_id).addClass('active');
						byS.createList(j['layers'])
					}
				});
		}
		,
		'getSlideshowSlides': function(slideshow_id){
			$.ajax({
					url: byS.ajaxURL,
					type: 'post',
					data: 'slideshow_id=' + slideshow_id + '&t=G' ,
					dataType: 'json',
					success: function(JSON) {
						if(JSON['slides']){
							$('#allLang li').each(function(ind,elm){
								LiD = $(this).data('id');
								if(JSON['slides'][LiD]){
									$('#group-sliders-'+LiD+' .new-slider-item').after(JSON['slides'][LiD])
								}
							});
						}
					}
				});
		}
		,
		'newSlide':function(){
			byS.lId =  $('.slide-lang.active').data('lid');
			if(!$('#tab-lang-'+byS.lId+' .slider-top-clone ').hasClass('hidden')){
				$('#tab-lang-'+byS.lId+' .slider-top-clone ').addClass('hidden');
			}
			byS.deleteLayers();
			
			$('[data-def]').each(function(){
					$(this).val($(this).data('def'));
				});
		
			$('[data-def-src]').each(function(){
					$(this).attr('src',$(this).data('def-src'));
				});
		
		
			$('#group-sliders-'+byS.lId+' .slider-item.active').removeClass('active');
			$('#slider_image_src_'+byS.lId).attr('src',sSrc);
			sliderSort();
		
			byS.countItem=0;
			byS.maxId=0;
			byS.createDefaultLayerData();
		}
		,
		'createList' : function( layers  ){
			byS.state = false;
			var layer = '';
			
			// Silinecek unutma
			if( layers ) {
				$.each( layers, function(i, jslayer ){
						byS.maxId++;
						var type = jslayer['layer_type']?'add-'+jslayer['layer_type']:'add-text';
						layer = byS.createLayer( type, jslayer , byS.maxId );
						
					});
			}
			byS.setDevice(1);
			byS.state = true;
		}
		,
		'createLayer' : function( type, data, slayerID ){

			var layer = $('<div class="draggable-item tp-caption" data-form=""><div class="caption-layer"></div></div>');
			layer.attr('id','slayerID'+ slayerID ); 
			layer.attr('lid',slayerID ); 

			var ilayer = $('<div class="layer-index"></div>').attr("id","i-"+layer.attr("id"));
			ilayer.append( '<span class="status"><i class="fa fa-fw fa-eye"></i></span>' );
			ilayer.append( '<span class="i-no">'+($(".draggable-item",$("#layer-editor-" + byS.lId)).length+1)+'</span>' );
			ilayer.append( '<span class="layer-index-caption"></span>' );
			ilayer.append( '<div class="item-ranger"><div class="item-range" data-str="0" data-stp="'+byS.delayTime+'"></div></div>' );

			switch( type ){
				case 'add-text': 
					byS.addLayerText( layer , ilayer, "Text " + slayerID );
					break;
				case 'add-video': 
					byS.addLayerVideo( layer , ilayer, "Video " + slayerID  );
					break;
				case 'add-image': 
					byS.addLayerImage(layer , ilayer,  "Image " + slayerID );
					break;	
			}
	 	 	
	 	 	
			$("#layer_id-"+byS.lId).val(slayerID );
	 			 		
			byS.setCurrentLayerActive(layer);	
	 		
			$(layer).draggable({ containment: ".layer-editor-"+ byS.lId,
					//handle: ".handle",
					drag:function(){
						byS.setCurrentLayerActive( layer );
						byS.updatePosition( layer.css('left'), layer.css("top") );
					},
					create:function(){
						byS.createDefaultLayerData( layer, data );
					}
				});
	    	
			$('input,select,textarea', '#layer-form-'+ byS.lId ).change( function(){
					console.log(' form change')
				  
					if( $(this).attr('name') =='layer_pos_'+byS.currentDevice +'_top' || $(this).attr('name') == 'layer_pos_'+byS.currentDevice +'_left' ) {  
					
						byS.currentLayer.css( { top:$('#layer-form-'+ byS.lId+' [name="layer_pos_'+byS.currentDevice +'_top"]','#layer-form-'+ byS.lId ).val()+"px",			
								left:$('#layer-form-'+ byS.lId+' [name="layer_pos_'+byS.currentDevice +'_left"]','#layer-form-'+ byS.lId ).val()+"px"				
							});	
					}
					if( $(this).attr('name') =='layer_start_time') {  
						$('#timeline-'+byS.lId).slider( 'values',0,$(this).val() );
						$('#layer-collection-'+byS.lId+' .layer-active .item-range').data('str',$(this).val());
						byS.rangeSlider()
					}
					if( $(this).attr('name') =='layer_end_time') {  
						$('#timeline-'+byS.lId).slider( 'values',1,$(this).val() );
						$('#layer-collection-'+byS.lId+' .layer-active .item-range').data('stp',$(this).val());
						byS.rangeSlider()
					}
					
					if( $(this).attr('attr') =='top') {
						byS.currentLayer.css( 'left',$(this).val()+'px');
					}
					if( $(this).attr('attr') =='top') {
						byS.currentLayer.css( 'top',$(this).val()+'px');
					} 
					if( $(this).attr('attr') =='font-size') {
						byS.currentLayer.css( 'font-size',$(this).val()+'px');
					}  
					
					if( $(this).attr('attr') =='color') {
						byS.currentLayer.css( 'color',$(this).val());
					}
					
					if( $(this).attr('attr') =='font-weight') {
						byS.currentLayer.css( 'font-weight',$(this).val());
					}  
					byS.storeCurrentLayerData();  
				});
			
			$('#input-layer-caption-'+ byS.lId, '#layer-form-' + byS.lId ).keypress( function(){  
					setTimeout(function ()
						{ 
							$(".caption-layer",byS.currentLayer).html( $('#input-slider-caption-'+ byS.lId).val()  );
							$('.layer-index-caption',"#i-"+byS.currentLayer.attr("id") ).text( $(".caption-layer",byS.currentLayer).text() );	
				 	
						}, 6);
				});

			layer.click( function() { 
					byS.setCurrentLayerActive( layer );	 
				});
	 		
			$("#i-"+layer.attr("id") ).click( function(){
					if( byS.currentLayer != null ){
						byS.storeCurrentLayerData();
					}
					byS.setCurrentLayerActive(layer); 
				});
	 		
			if(type == "add-image" && data==null){
				byS.showDialogImage(layer.attr('lid'));
			}	
	 		
		}
		,
		'createDefaultLayerData' : function( layer, data ){
			byS.lId =  $('.slide-lang.active').data('lid');
			var _left = 1;
			var _top  = 1;
			var _vertical = 'top';
			var _horizontal = 'left';
			
			if( data != null && data ) { 
				
				$.each( data , function(key, valu){	
						switch(key){
							case 'layer_caption':
								valu = valu.replace( /_ASM_/,'&' );
								$( '[name="'+key+'"]','#layer-form-'+byS.lId ).val(valu);
								break;
							case 'layer_linkstatus':
								$('[name="'+key+'"]','#layer-form-'+byS.lId ).val(valu);
								if(valu=='1'){
									$( 'input[type="checkbox"][name="layer_linkstatus"]' ).prop( "checked", true );
								}else{
									$( 'input[type="checkbox"][name="layer_linkstatus"]' ).prop( "checked", false );
								}
								break;
							default:
								$( '[name="'+key+'"]','#layer-form-'+byS.lId ).val(  valu );
						}
						
						
					} ); 

				if(  data['layer_type'] == 'image' ){
					var thumb = 'img_'+byS.currentLayer.attr('id');
					var src = img_url+data['layer_image'];
					$('#' + thumb).replaceWith('<img src="' + src + '" alt="" id="' + thumb + '" />');
				}
			
				if(  data['layer_type'] == 'video' ){
					var thumb = 'video-'+byS.currentLayer.attr('id');
					var src = data['layer_video_thumb'];
					$(".content-sample",byS.currentLayer).html( '<img height="'+data['layer_video_height']+'" width="'+data['layer_video_width']+'" src="'+src+'"/>');
				}
			
				if(  data['layer_type'] == 'text' ){
					byS.currentLayer.addClass(  data['layer_class'] );
				}

				$(layer).addClass('pos-'+data['layer_hpos']+'-'+data['layer_vpos']);
				
				$('[data-h="'+data['layer_hpos']+'"][data-v="'+data['layer_vpos']+'"]').addClass('active');
				if(data['layer_hpos']){_horizontal = data['layer_hpos']}	
				if(data['layer_vpos']){_vertical = data['layer_vpos']}
				if(data['layer_left']){_left = data['layer_left']}
				if(data['layer_top']){_top = data['layer_top']}
				
				data['layer_caption'] = data['layer_caption'].replace(/_ASM_/,'&');
		 
				$(".caption-layer",byS.currentLayer).html( data['layer_caption'] );
				$(".layer-index-caption", '#i-slayerID'+data['layer_id']).text( $(".caption-layer",byS.currentLayer).text()  );

 			
				$('#timeline-'+ byS.lId).slider( "values", 0, data['layer_starttime'])
				$('#timeline-'+ byS.lId).slider( "values", 1, data['layer_endtime'] )
				
				byS.currentLayer = layer;
				$(byS.currentLayer).css({"left": data['layer_left']+'px', "top": data['layer_top']+'px'});
			}
			else 
			{
				$('#layer-form-'+byS.lId+' [name="layer_caption"]').val(  $(".caption-layer",layer).html() );
				$('#layer-form-'+byS.lId+' [name="layer_left"]').val(1);
				$('#layer-form-'+byS.lId+' [name="layer_top"]' ).val(1);
				$('#layer-form-'+byS.lId+' [name="layer_class"]').val('');
				$('#layer-form-'+byS.lId+' [name="layer_startspeed"]' ).val(350);
				$('#layer-form-'+byS.lId+' [name="layer_starttime"]' ).val(0);
				$('#layer-form-'+byS.lId+' [name="layer_endtime"]' ).val(byS.delayTime );
				$('#layer-form-'+byS.lId+' [name="layer_endspeed"]').val(300);
				$('#layer-form-'+byS.lId+' [name="layer_endanimation"]').val('auto');
				$('#layer-form-'+byS.lId+' [name="layer_endeasing"]' ).val('nothing');
				$('#layer-form-'+byS.lId+' [name="layer_content"]').val('no_image.png');
				$('#timeline-'+ byS.lId).slider( "values", 0,0)
				$('#timeline-'+ byS.lId).slider( "values", 1, byS.delayTime )
				$('#layer-form-'+byS.lId+' .pos-view').removeClass('active');
				$('[data-h="left"][data-v="top"]').addClass('active');
			}
			
	 		$('#pos-view'+byS.lId+' li:first-child a').addClass('active')
	 		$('#layer-form-'+byS.lId+' .pos-view:first-child').addClass('active show')
	 		
			$('.bytao-switch-btn input[type=checkbox]').each(function(e){
					if($( this ).prop( "checked" )){
						$('#'+$(this).attr('ms-elem')).show();
					}else{
						$('#'+$(this).attr('ms-elem')).hide();
					}
				});
			
			if(layer){
				byS.setPosition( _left, _top,_horizontal,_vertical,layer,'createDefaultLayerData');
			}
	 		
	 		
	 		
			byS.storeCurrentLayerData();
			byS.rangeSlider();
		}
		,		
		'addLayerText' : function( layer, ilayer , caption ){  
			layer.addClass('layer-text');
			$(".caption-layer",layer ).html( caption );
			$("#layer-editor-" + byS.lId ).append( layer );
			$("#layer_type-"+byS.lId).val('text');
			$("#layer-collection-" + byS.lId ).append( ilayer );
			$(".layer-index-caption", ilayer).html( caption );
		}
		,
		'addLayerVideo' : function( layer, ilayer , caption ){
			layer.addClass('layer-content');
			$(".caption-layer",layer ).html( caption );
			$("#layer-editor-" + byS.lId ).append( layer );

			$("#layer-collection-" + byS.lId ).append( ilayer ); $(".layer-index-caption", ilayer).html( caption );
		
			$("#layer_type-"+byS.lId).val('video');
			layer.append( '<div class="layer_video" id="'+'video-'+layer.attr('id')+'"><div class="content-sample"></div></div><div class="btn-change-video">Chang Video</div>' );

		}
		,
		'addLayerImage' : function( layer, ilayer , caption ){
			layer.addClass('layer-content');
			$(".caption-layer",layer ).html( caption );
			layer.append( '<div class="layer_image" id="'+'img_'+layer.attr('id')+'"><div class="content-sample"></div></div><div class="btn-change-img">Change Image</div>' );

			$("#layer-editor-" + byS.lId ).append( layer );
			$("#layer-collection-" + byS.lId ).append( ilayer ); $(".layer-index-caption", ilayer).html( caption );
		
			$("#layer_type-"+byS.lId).val('image');
			$("#layer_content-"+byS.lId).val('');
			// show input form
		
		}
		,	
		'updatePosition' : function( left, top ){
			
			eW	 = $('[name="slider[width]"]').val();
			eH	 = $('[name="slider[height]"]').val();
			
			hVal = $('[name="layer_hpos"]','#layer-form-'+byS.lId ).val();
			vVal = $('[name="layer_vpos"]','#layer-form-'+byS.lId ).val();	
			aH	 = $('.layer-active','#layer-editor-'+byS.lId).height();
			aW	 = $('.layer-active','#layer-editor-'+byS.lId).width();
			var H = parseInt(eH - aH);
			var W = parseInt(eW - aW);
			
			if(hVal == 'left'){W = 0;}
			if(hVal == 'center'){W = parseInt(eW/2);}
			if(hVal == 'right'){W = parseInt(W);}
			
			if(vVal == 'top'){ H= 0;}
			if(vVal == 'middle'){H = parseInt(H/2);}
			if(vVal == 'bottom'){H = parseInt(eH - aH);}
			
			_left = parseInt(left) ;
			_top =  parseInt(top) ;	
			
			//$('.layer-active','#layer-editor-'+byS.lId).css({"left": _left, "top": _top});
		
			$( '[name="layer_top"]','#layer-form-'+ byS.lId ).val(parseInt(_top) );
			$( '[name="layer_left"]','#layer-form-'+ byS.lId ).val(parseInt(_left) );

			byS.storeCurrentLayerData();
		}
		,
		'setPosition' : function(left,top,hVal,vVal,layer,FROM){
			$('[name="layer_top"]','#layer-form-'+ byS.lId ).val(parseInt(top) );
			$('[name="layer_left"]','#layer-form-'+ byS.lId ).val(parseInt(left) );
			
			var eW	 = $('[name="slider[width]"]').val();
			var eH	 = $('[name="slider[height]"]').val();
			var aH	 = $(layer).height();
			var aW	 = $(layer).width();
			
			var H = parseInt(eH - aH);
			var W = parseInt(eW - aW);
			
			if(hVal == 'left'){W = 0;}
			if(hVal == 'center'){W = parseInt(eW/2);}
			if(hVal == 'right'){W = parseInt(W);}
			
			if(vVal == 'top'){ H= 0;}
			if(vVal == 'middle'){H = parseInt(H/2);}
			if(vVal == 'bottom'){H = parseInt(eH - aH);}
			
			if(left>0){
				_left = W + parseInt(left);	
			}else if(left<0){
				_left = W - parseInt(left * -1);
			}else{
				_left = W ;
			}
			
			if(top>0){
				_top = H + parseInt(top);	
			}else if(top<0){
				_top = H - parseInt(top * -1);
			}else{
				_top = H ;
			}
			
			//$(layer).css({"left": _left +'px',"top": _top + 'px'});
			//$('.layer-active','#layer-editor-'+byS.lId).css({"left": _left, "top": _top});
			//$('.layer-active','#layer-editor-'+byS.lId).css({"left": left, "top": top});
			$(layer).css({"left": left, "top": top});
			
			
		}
		,
		'deleteAction': function(action){
			switch(action){
				case 'delete-layer':
				byS.deleteCurrentLayer();
				break;
				case 'delete-slider':
				byS.deleteCurrentSlider();
				break;
			
			}
		}
		,
		'deleteCurrentSlider': function(){
			
			if( byS.currentLayer ){
				byS.currentLayer.data( "form", null );
				$( "#i-"+byS.currentLayer.attr("id") ).remove();
				$(".draggable-item",$('#layer-editor-'+byS.lId)).remove();
				$(".layer-index",$('#layer-collection-'+byS.lId)).remove();
				byS.newSlide();
			}
		}
		,
		'deleteCurrentLayer': function(){
			
			if( byS.currentLayer ){
				byS.currentLayer.data( "form", null );
				$( "#i-"+byS.currentLayer.attr("id") ).remove();
				$(".draggable-item.layer-active",$('#layer-editor-'+byS.lId)).remove();
				$(".layer-index.layer-active",$('#layer-collection-'+byS.lId)).remove();
				
				if( $('.draggable-item',$('#layer-editor-'+byS.lId)).length <= 0 ) {
					$('#dialog').remove();
					$('#dialog-video').hide();
				}
			}
		}
		,
		'deleteLayers': function(){
			$('#layer-editor-'+byS.lId).empty();
			$('#layer-collection-'+byS.lId).empty();
			if( byS.currentLayer ) byS.currentLayer.data( "form", null );	
		}
		,
		'showDialogImage' : function( thumb ){ // image layer change
			byS.currentLayer
			
			$('#img_slayerID'+thumb).replaceWith('<img src="" alt="" id="img_slayerID'+thumb + '" />');
			$('#modal-image').remove();
			$.ajax({
					url: 'index.php?route=common/filemanager&user_token={{ user_token }}&target=layer_image_' + byS.lId +'&simage=img_slayerID'+thumb ,
					dataType: 'html',
					success: function(html) {
						$('body').append(html);
						var element = document.querySelector('#modal-image');
						var modal = new bootstrap.Modal(element);
						modal.show();
					}
				});
		}
		,
		'processDialogVideo' : function( videoID ){
			byS.currentLayer
			
			if( videoID !="" ) {
 				
				if( $("#layer_video_type").val() == 'vimeo' ) {
					$.getJSON('http://www.vimeo.com/api/v2/video/' + videoID + '.json?callback=?', {format: "json"}, function(data) {
					
							$this.showVideoPreview( data[0].title, data[0].description, data[0].thumbnail_large );
						});
				}else {
					$.getJSON('http://gdata.youtube.com/feeds/api/videos/'+videoID+'?v=2&alt=jsonc',function(data,status,xhr){ 
							$this.showVideoPreview( data.data.title, data.data.description, data.data.thumbnail.hqDefault )
						});
				}
			}
		}
		,
		'showVideoPreview': function( title, description, image ){
			
			if( title ){
				var html = '';
				html += '<div class="video-title">'+title+'</div>';	
				html += '<img src="'+image+'">';
				html += '<div class="video-description">'+description+'</div>';	
				$("#layer_video_thumb").val(image);	
				$("#video-preview").html( html );
				$("#apply_this_video").show();
			}else {
				$("#video-preview").html( '<div class="error">Could not find any thing</div>' );
			}
		}
		,
		'setCurrentLayerActive' : function ( layer ){
			if(byS.activeLayer != $(layer).attr('lid')){
				if(byS.state) byS.updateLayerDataForm();
				$("#layer-editor-"+byS.lId+" .draggable-item").removeClass("layer-active");
				$(".layer-index","#layer-collection-"+byS.lId).removeClass("layer-active");
				$('#i-'+layer.attr("id") ).addClass("layer-active");
				$( layer ).addClass("layer-active");
				byS.activeLayer = $(layer).attr('lid');
				byS.currentLayer = layer;
				byS.showLayerForm( layer );	
				byS.rangeSlider();
			}
		}
		,
		'setDevice':function (aDev){
			byS.currentDevice = $('#layer-form-'+byS.lId+' .device-view > .active').attr('device');
			$('#layer-form-'+byS.lId+' .pos-view').hide();	
			$('#layer-form-'+byS.lId+' #pos-view-'+aDev).show();
			$('#layer-form-'+byS.lId+' .draggable-item').each(function(){
				byS.setCurrentLayerActive( $(this));	
			});
		}
		,
		'showLayerForm': function( layer ){
			var $currentLayer = byS.currentLayer;
			if( $currentLayer.data("form") ){ 
				$.each( $currentLayer.data("form"), function(_, kv) {
					
						switch(kv.name){
							case 'layer_linkstatus':
								if(kv.value=='1'){
									$( 'input[type="checkbox"][name="layer_linkstatus"]' ).prop( "checked", true );
									$('#layer_link_group'+ byS.lId).show();
								}else{
									$( 'input[type="checkbox"][name="layer_linkstatus"]' ).prop( "checked", false );
									$('#layer_link_group'+ byS.lId).hide();
								}
								break;
								
							case 'layer_image':
								if($('.tp-caption.layer-active').find('.caption-layer').length){
									iId = $('.tp-caption.layer-active').find('.caption-layer').attr('id');
									$('#img-'+iId).replaceWith('<img src="' +img_url+kv.value+ '" alt="" id="img_'+iId+'" />');
								}
								$('#layer-form-'+ byS.lId +' [name="'+kv.name+'"]' ).val( kv.value );
								break;
							case 'layer_type':
								if(kv.value=='text'){
									$('#layer-form-'+ byS.lId +' .font').removeClass('hidden');
								}else{
									$('#layer-form-'+ byS.lId +' .font' ).addClass('hidden');
								}
							case 'layer_hpos':
								if(kv.value){
									$('#layer-form-'+ byS.lId +' [name="'+kv.name+'"]' ).val( kv.value );
								}else{
									$('#layer-form-'+ byS.lId +' [name="'+kv.name+'"]' ).val( 'left' );
								}
								break;
							case 'layer_vpos':
								if(kv.value){
									$('#layer-form-'+ byS.lId +' [name="'+kv.name+'"]' ).val( kv.value );
								}else{
									$('#layer-form-'+ byS.lId +' [name="'+kv.name+'"]' ).val( 'top' );
								}
								break;
							default:
								$('#layer-form-'+ byS.lId +' [name="'+kv.name+'"]' ).val( kv.value );
						}
						
						switch(kv.name){
							case 'layer_width':
								if(kv.value){
									$(layer).css('width',kv.value+'px');
								}else{
									$(layer).css('width','unset');
								}
								
								break;
							case 'layer_fontsize':
								$(layer).css('font-size',kv.value+'px');
								break;
							case 'layer_fontcolor':
								$(layer).css('color',kv.value);
								break;
							case 'layer_pos_fontweight':
								$(layer).css('font-weight',kv.value);
								break;
							case 'layer_lineheight':
								$(layer).css('line-height',kv.value+'px');
								break;
						}
				} ); 
			}
			 
			$('#timeline-'+ byS.lId).slider( "values", 0,$('#layer_starttime-'+ byS.lId).val() )
			$('#timeline-'+ byS.lId).slider( "values", 1,$('#layer_endtime-'+ byS.lId).val() )
			$('.inGroup').each(function(e){
					if($( this ).prop( "checked" )){
						$('#'+$(this).attr('ms-elem')).show();
					}else{
						$('#'+$(this).attr('ms-elem')).hide();
					}
			});
			
			$('#layer-form-'+byS.lId+' .pos-view').removeClass('active show');
				
			hVal = $('[name="layer_hpos"]','#layer-form-'+byS.lId ).val();
			vVal = $('[name="layer_vpos"]','#layer-form-'+byS.lId ).val();	
			
			$('.layer-align-table .active').removeClass('active');
			$('[data-h="'+hVal+'"][data-v="'+vVal+'"]','#layer-form-'+byS.lId+' .layer-align-table').addClass('active');
			
	 		byS.setPosition($('[name="layer_left"]','#layer-form-'+byS.lId ).val(),$('[name="layer_top"]','#layer-form-'+byS.lId ).val(),hVal,vVal,byS.currentLayer,'showlayer');
	 		
			$('.layer-form').show();
		}
		,
		'storeCurrentLayerData':function(){
			byS.state = false; 
			byS.currentLayer.data("form", $('#layer-form-'+ byS.lId ).serializeArray() );
	 		
		}
		,
		'rangeSlider':function(){
			var crpn = byS.delayTime / 154;
			var iStart =  parseInt($('#timeline-'+ byS.lId).slider( "values", 0 ));
			var iStop =  parseInt($('#timeline-'+ byS.lId).slider( "values", 1 ));
			var iWidth =parseInt((iStop - iStart)*154/ byS.delayTime) ; 
			
			$('#layer-collection-'+byS.lId+' .layer-active .item-range').css({'left':parseInt(iStart*154/byS.delayTime)+'px','width':+iWidth+'px'});
		}
		,
		'updateLayerDataForm':function(){
			if($("#layer-editor-"+byS.lId+" .draggable-item.layer-active").length){
				byS.currentLayer.data("form", $('#layer-form-'+ byS.lId ).serializeArray() );
			}
		}
		,
		'getCurrentSlideCount':function(SlideID){
			if($('#arr .A'+byS.lId).find('.'+SlideID).length>0){
				byS.countItem = $('#arr .A'+byS.lId).find('.'+SlideID).data('countItem');	
			
			}else{
				if($('#arr .A'+byS.lId).length>0){
					$('#arr .A'+byS.lId).append('<div class="'+SlideID+'"></div>');
				}else{
					$('#arr').append('<div class="A'+byS.lId+'"><div class="'+SlideID+'"></div></div>');
				}
				$('#arr .A'+byS.lId).find('.'+SlideID).data('countItem',0);
				byS.countItem =0;
			
			}
		}
		,
		'submitForm' : function(){
			byS.lId =  $('.slide-lang.active').data('lid');
			layerSliderId = $("#slider_id-"+ byS.lId).val();
			if(!layerSliderId){	layerSliderId=0;}
			var data =[];
			var i = 0;
			var params = "slider_id="+layerSliderId+"&"+$("#slayt-form-"+ byS.lId).serialize()+"&";
			var times = '';
			 
			$("#layer-editor-"+ byS.lId +" .draggable-item" ).each( function(){
					var param = '';
					$.each($(this).data("form"), function(_,e ) {
							if( $(this).attr('name').indexOf('layer_time') ==-1 ){
								if( e.name == 'layer_caption' ){
									e.value = e.value.replace(/\&/,'_ASM_');
								}  
								param += 'layers['+i+']['+e.name+']='+e.value+'&';
							}
						});
					params += 	param+"&";
					i++
				});
			 
			$(".input-time input", $("#slayt-form-"+ byS.lId) ).each( function(i,e){
					params +=$(e).attr('name')+"="+$(e).val()+"&";
				}); 
			params +="th="+tHeight;
			$.ajax({
					url: $("#layer-form-"+ byS.lId).attr('action'),
					dataType: 'JSON',
					data: params,
					type: 'POST',
					success: function(resp) {
						if( resp['error'] ){
							$('#alerter .modal-body').addClass('alert-danger').html('<i class="fa-solid alert-dismissible"></i> '+resp['error']);
							$('#alerter').modal('show');
						}
				 		  
						if(resp['newlayer'])
						{
							$('#group-sliders-'+byS.lId+' .slider-item.active').removeClass('active');
							$('#group-sliders-'+byS.lId+' .new-slider-item').after('<div class="slider-item" data-id="'+resp['newlayer'] +'" id="slider-item-'+resp['newlayer'] + '" > <a class="image" href="#" data-layer_id="'+resp['newlayer'] +'"><img class="img-responsive" src="'+resp['thumbnail'] +'" height="86"/></a><a  title="'+clone_this+'" class="slider-clone" href="#" data-layer_id="'+resp['slider_id'] +'"><span>'+clone_text+'</span></a><a  title="'+delete_this+'" class="slider-delete" href="#" data-layer_id="'+resp['newlayer'] +'"><span>'+delete_text+'</span></a><a class="slider-status" href="#" data-layer_id="'+resp['newlayer'] +'"><span>'+status_text+'</span></a><div>'+resp['slider_title']+'</div></div>');
							uL = resp['newlayer'] ;
							if(resp['slider_status'] == 0 ){
								$('#slider-item-'+uL+' .slider-status').addClass('slider-status-off');	
							}else{
								$('#slider-item-'+uL+' .slider-status').removeClass('slider-status-off');	
							}
							alert(resp['text_added_slider']);
						}
				 		  
						if(resp['updatelayer'])
						{
							uL = resp['slider_id'] ;
							$('#slider-item-'+uL).data('id',resp['updatelayer']);
							$('#slider-item-'+uL+' [data-id]').data('id',resp['updatelayer']);
							$('#slider-item-'+uL+' img').attr('src',resp['thumbnail']);
							$('#slider-item-'+uL+' div').html(resp['slider_title']);
								
							if(resp['slider_status']==0 ){
								$('#slider-item-'+uL+' .slider-status').addClass('slider-status-off');	
							}else{
								$('#slider-item-'+uL+' .slider-status').removeClass('slider-status-off');	
							}
							$('#alerter .modal-body').addClass('alert-danger').html('<i class="fa-solid alert-dismissible"></i> '+resp['text_updated_slider']);
							$('#alerter').modal('show');
						}
					}
				});
				
		}
		
	}


</script>
  
<script type="text/javascript"><!--
	byS.setOP({'lId':$('#languagetabs > li:first').data('lid')});	
	
	function removeColorClasses(objId,str)
	{
		elem = document.getElementById(objId)
		for (let className of Array.from(elem.classList))
		if (className.startsWith(str))
		elem.classList.remove(className);
	}
			
	function alignActiveLayer(h,v){
		byS.lId =  $('.slide-lang.active').data('lid');
		removeColorClasses($("#slider-editor-"+byS.lId+" .layer-active").attr('id'),"pos");
		$('#slider-editor-'+byS.lId+' .layer-active').addClass('pos'+h+v);
		$('#layer-form-'+byS.lId+' [name="layer_pos"]').val(h+','+v);
		
	}


	$(document).on('click','.caption-layer a',function(e){
		e.preventDefault();
		return false;
	});
	
	$(document).on('click','.slide-lang.active .dropdown-toggle',function(){
			if($(this).parent().hasClass('open')){
				$(this).parent().removeClass('open');
			}else{
				$(this).parent().addClass('open');
			}
	});
	
	$(document).on('click','.device-view > button',function(e){
		e.preventDefault();
		byS.lId =  $('.slide-lang.active').data('lid');
		if(!$(this).hasClass('active')){
			$('#layer-form-'+byS.lId+' .device-view > button').removeClass('active');
			$(this).addClass('active');
			byS.setDevice($(this).attr('device'));
		}
	});
		
	$(".flex-control").each(function(e){
			tWidth = $(this).find('i').length;
			$(this).animate({marginRight:'-'+( tWidth * 32) + 'px'},100)
		});	
		
	$(".flex-control,.layer-collection").mouseenter(function(){
			$(this).animate({marginRight:'0px'},100,function(){
				$(this).removeClass('smalled')
			})
		});

	$(".flex-control").mouseleave(function() {
			tWidth=$(this).width();
			$(this).animate({marginRight:'-'+( tWidth - 32) + 'px'},100,function(){
				$(this).addClass('smalled');
			})
		});
	$(".layer-collection").each(function(e){
			tWidth = $(this).find('i').length;
			$(this).animate({marginRight:'-'+( tWidth * 30) + 'px'},100)
		});	
	
	$(".layer-collection").mouseleave(function() {
			tWidth=$(this).width();
			$(this).animate({marginRight:'-'+( tWidth - 52) + 'px'},100,function(){
				$(this).addClass('smalled');
			})
		});
		
	$('#top-tabs').on('click', '.nav-item > a', function (e) {
		e.preventDefault();
		if($(this).attr('href')=='#tab-slides'){
			$('.minbuttons').addClass('hidden');
		}else{
			$('.minbuttons').removeClass('hidden');
		}
	});		
	
	$(document).on('click', '[data-ms-toggle=\'tab\']', function (e) {
		e.preventDefault();
	    var element = this;
	    	$(element).parent().parent().find('.ms-tablink.active').removeClass('active');
	    	$(element).addClass('active');
	    var tElement = $($(element).attr('href'));
	    
		$(tElement).parent().find('.tab-pane').removeClass('active');
	    $(tElement).addClass('active show');
	});	
	
	$(document).on('click', '[data-toggle="collapse"]', function (e) {
		$($(this).data('target')).toggleClass('show');
	});
	
	$(document).on('click', '#opener', function (e) {
		e.preventDefault();
		if($(this).find('i').hasClass('fa-arrow-circle-right')){
			$('#layer-form-content-'+byS.lId).animate({left:'0px'},400,function(){
				$('#layer-form-content-'+byS.lId+' #opener i').removeClass('fa-arrow-circle-right').addClass('fa-arrow-circle-left');
			});
		}else{
			$('#layer-form-content-'+byS.lId).animate({left:'-52%'},400,function(){
				$('#layer-form-content-'+byS.lId+' #opener i').removeClass('fa-arrow-circle-left').addClass('fa-arrow-circle-right');
			});
		}
	
		return false;
	});	
	
	
	
	$( document ).ready( function(){
		slideshowId = $('#slideshow_id').val();
		byS.getSlideshowSlides(slideshowId)
	});
	
	$( document ).ready( function(){
		
		$('.scollapse').collapse();
		
		
		var SURLIMAGE = 'index.php?user_token={{ user_token }}';
		var SURL = '{{ HTTP_CATALOG }}';
		{% for language in languages %}
			$('#timeline-{{ language.language_id }}').slider({
					range: true,
					min: 0,
					max: byS.delayTime,
					values: [ 0,  byS.delayTime ],
					slide: function( event, ui ) {
						$('#layer_start_time-{{ language.language_id }}').val( ui.values[ 0 ] );
						$('#layer_end_time-{{ language.language_id }}').val( ui.values[ 1 ] );
						$('#layer-collection-'+byS.lId+' .layer-active .item-range').data('str',ui.values[ 0 ]);
						$('#layer-collection-'+byS.lId+' .layer-active .item-range').data('stp',ui.values[ 1 ]);
	        
						byS.rangeSlider()
					}
				});
		{% endfor %}
		
		sliderSort()
		$('.inGroup').each(function(e){
			if($( this ).prop( "checked" )){
				$('#'+$(this).attr('ms-elem')).show();
			}else{
				$('#'+$(this).attr('ms-elem')).hide();
			}
		});
			
								
		});
		
	function sliderSort(){
		{% for language in languages %}
		$("#group-sliders-{{ language.language_id }}").sortable({ 
				accept:"#group-sliders-{{ language.language_id }} .slider-item",
				update:function() {   
					var ids = $( "#group-sliders-{{ language.language_id }} .slider-item" );
					var params = '';
					var j=1;
					$.each( ids, function(i,e){
							params += 'id['+$(e).attr('id').replace("slider_","")+']='+(j++)+"&";
						});
					$.ajax({
							url:'index.php?route=bytao/slideshow.savepos&user_token={{ user_token }}',
							data: params,
							type:'POST'
						});
				} 
			});
		
		$("#group-sliders-{{ language.language_id }}" ).disableSelection();
		{% endfor %}
	}

	
	//-->
</script> 

{{ footer }} 
