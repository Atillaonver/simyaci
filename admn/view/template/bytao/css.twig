{{ header }}{{ column_left }}
<div id="content">
	  <style>
  	span.sname {
    text-transform: capitalize;
    font-size: medium;
    margin-right: 8px;
    }
     .changed {
	    color: red !important;
	}
  </style>
  <div class="container-fluid">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-list"></i> {{ text_edit }}</h3>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-sm-12">
            <div class="alert alert-info"><i class="fa fa-info-circle"></i> {{ text_info_css }}</div>
                        
            <div id="code">
              <ul class="nav nav-tabs" id="css">
              
              {% for css in allCss %}
              <li class="nav-item"><a href="#tab-{{ loop.index }}" data-bs-toggle="tab" class="nav-link">V:<span>{{ css.version }}</span>  {{ css.name }}</a></li>
              {% endfor %}	
              </ul>
              <div class="tab-content">
              	{% for css in allCss %}
              	<div class="tab-pane" id="tab-{{ loop.index }}">
                    <textarea name="code" id="input-code{{ loop.index }}" rows="10" class="form-control">{{ css.css | html_entity_decode }}</textarea>
                    <input type="hidden" name="type" value="{{ css.type }}" id="input-{{ loop.index }}-type"/>
                    <input type="hidden" name="css_id" value="{{ css.css_id }}" id="input-{{ loop.index }}-css_id"/>
                    <br/>
                    <div class="pull-left">
                    <button type="button" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> {{ button_save }}</button>
                    
                    </div>
                    </div>
                {% endfor %}	
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <link href="view/javascript/codemirror/lib/codemirror.css" rel="stylesheet" />
  <link href="view/javascript/codemirror/theme/monokai.css" rel="stylesheet" />
  
	<script type="text/javascript" src="view/javascript/codemirror/lib/codemirror.js"></script>
	<script type="text/javascript" src="view/javascript/codemirror/mode/css.js"></script> 
	<script type="text/javascript" src="view/javascript/codemirror/lib/formatting.js"></script> 
	<script type="text/javascript" src="view/javascript/codemirror/lib/search.js"></script> 
	<script type="text/javascript" src="view/javascript/codemirror/lib/searchcursor.js"></script> 
	<script type="text/javascript" src="view/javascript/codemirror/lib/jump-to-line.js"></script> 
	<script type="text/javascript" src="view/javascript/codemirror/lib/css-hint.js"></script> 
	<script type="text/javascript" src="view/javascript/codemirror/lib/csslint.js"></script> 
	<script type="text/javascript" src="view/javascript/codemirror/lib/closebrackets.js"></script> 
	<script type="text/javascript" src="view/javascript/codemirror/lib/rulers.js"></script> 
	<script type="text/javascript" src="view/javascript/codemirror/lib/autorefresh.js"></script> 
	<script type="text/javascript" src="view/javascript/codemirror/lib/match-highlighter.js"></script> 
	<script type="text/javascript" src="view/javascript/codemirror/lib/fullscreen.js"></script> 

	<link href="view/javascript/codemirror/lib/fullscreen.css" rel="stylesheet" />
	<link href="view/javascript/codemirror/lib/show-hint.css" rel="stylesheet" />
  
<script type="text/javascript">
$(document).ready(function(){
	var allOption = {
			mode: 'css',
			height: '800px',
			lineNumbers: false,
			autofocus: true,
			autoRefresh:true,
			smartIndent:true,
			lineWiseCopyCut: true,
			lineWrapping: true,
			theme: "monokai",
			tabSize: 2,
		    autoCloseBrackets: true,
		    matchBrackets: true,
		    showCursorWhenSelecting: true,
		    extraKeys: {"Ctrl-Q": function(cm){ cm.foldCode(cm.getCursor()); },"Ctrl-Space": "autocomplete"},
		    foldGutter: true,
		    gutters: ["CodeMirror-linenumbers", "CodeMirror-lint-markers"]
		};
	
	{% for item in allCss %}
		var codemirror{{ loop.index }} = CodeMirror.fromTextArea(document.getElementById('input-code{{ loop.index }}'),allOption );
			codemirror{{ loop.index }}.on("focus", function(){ codemirror{{ loop.index }}.refresh();});
			codemirror{{ loop.index }}.on("change", function(){ $('#css .nav-link.active').addClass('changed');});
			codemirror{{ loop.index }}.setSize('100%', '500px');
	{% endfor %}	
	
	$('#css a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
		switch($(this).index()){
			case 0:
				codemirror1.getCursor();
				break;
			case 1:
				codemirror2.refresh().focus().getCursor();
				break
			case 2:
				codemirror3.refresh().focus().getCursor();
				break	
			default:
				break;
		}
	});	
	$('.nav-tabs a[href=\'#tab-1\']').tab('show');
	
});
				

$('#code .tab-content').on('click', '.btn-primary', function(e) {
	e.preventDefault();
	
	var node = this;

	var editor = $('#code .tab-content .active .CodeMirror')[0].CodeMirror;
	var cssId = $('#code .tab-content .active input[name="css_id"]').val();
	var cssType = $('#code .tab-content .active input[name="type"]').val();
				
	$.ajax({
		url: 'index.php?route=bytao/css.save&user_token={{ user_token }}&css_id=' + cssId + '&type=' + cssType,
		type: 'post',
		data: 'code=' + encodeURIComponent(editor.getValue()),
		dataType: 'json',
		beforeSend: function() {
			//$(node).button('loading');
		},
		complete: function() {
			//$(node).button('reset');
		},
		success: function(json) {
			$('.alert-dismissible').remove();
			
			if (json['version']) {
				$('#css .active span').html(json['version']);
			}
			
			if (json['css_id']) {
				$('#code .tab-content .active input[name="css_id"]').val(json['css_id']);
			}
			
			
			if (json['error']) {
				alertDivided(json['error'],'danger');
				
			}

			if (json['success']) {
				alertDivided(json['success'],'success');
				$('#css .nav-link.active').removeClass('changed');
			}
		}
	});
});

$('#css a:first').trigger('click');

</script> 
</div>
{{ footer }} 