<ul class="nav nav-tabs"> 
	{% if export %}
	<li class="nav-item active"><a href="#tab-export" data-bs-toggle="tab" class="nav-link active">Export</a></li>
	{% endif %}
	{% if import %}
	<li class="nav-item"><a href="#tab-import" data-bs-toggle="tab" class="nav-link">Import</a></li>
	{% endif %}
</ul>
<div class="tab-content">
	{% if export %}
	<div class="tab-pane active" id="tab-export">
		<form action="{{ export }}" method="post" enctype="multipart/form-data" id="export" class="form-horizontal">
			<div class="row mb-3" style="margin:0px;">
				<div class="col-sm-12">{{ entry_export }}</div>
			</div>
			<div class="row mb-3" style="margin:0px;">
				<div class="col-sm-12">
					<input type="hidden" name="selected" id="IDs" />
					<a onclick="exportData();" class="btn btn-primary"><span>{{ button_export }}</span></a>
				</div>
			</div>
		</form>
	</div>
	{% endif %}
	{% if import %}
	<div class="tab-pane" id="tab-import">
		<form id="import" action="{{ import }}" enctype="multipart/form-data" class="form-horizontal" data-oc-toggle="ajax" data-oc-target="tab-import">
			<fieldset id="step1" class="">
			<div class="row mb-3" style="margin:0px;">
				<div class="col-sm-12">{{ entry_import }}
					<span class="help">{{ help_import }}</span>
					<span class="help">{{ help_format }}</span>
				</div>
			</div>
			
			<div class="row mb-3 required">
                <label for="input-filename" class="col-sm-2 col-form-label">{{ entry_filename }}</label>
                <div class="col-sm-10">
                  <div class="input-group">
                    <button type="button" id="button-upload" class="btn btn-primary"><i class="fa-solid fa-upload"></i> {{ button_upload }}</button>
                    <input type="text" name="filename" value="{{ filename }}" placeholder="{{ entry_filename }}" id="input-filename" class="form-control"/>
                    <button type="button" id="button-download" class="btn btn-outline-secondary"{% if not filename %} disabled{% endif %}><i class="fa-solid fa-download"></i> Load </button>
                  </div>
                  <div class="form-text">{{ help_filename }}</div>
                  <div id="error-filename" class="invalid-feedback"></div>
                </div>
              </div>
              <div class="row mb-3">
              	<label class="col-sm-2 col-form-label">Params</label>	
              	<div class="col-sm-10">
              	<div class="" id="importTitles"></div>
              	
              	<div class="form-text">for new record all parts will checked</div>	
              	</div>
              	
              </div>
              
			<div class="row mb-3">
	                <label for="input-status" class="col-sm-2 col-form-label">Build SEO Url</label>
	                <div class="col-sm-10">
	                  <div class="form-check form-switch form-switch-lg">
	                    <input type="checkbox" name="check[]" value="url" id="Checkurl" class="form-check-input"/>
	                  </div>
	                </div>
	            </div>  
			<div class="row mb-3">
	                <label for="input-status" class="col-sm-2 col-form-label">With Images</label>
	                <div class="col-sm-10">
	                  <div class="form-check form-switch form-switch-lg">
	                    <input type="checkbox" name="check[]" value="image" id="Checkimg" class="form-check-input" disabled/>
	                  </div>
	                </div>
	            </div>
	            
			<div class="row mb-3" style="margin:0px;">
				<label class="col-sm-2 col-form-label"></label>
				<div class="col-sm-10">
					<input type="hidden" name="code" id="code" />
					<button type="submit" id="btn-gate-submit" class="btn btn-primary">{{ button_import }}</button>
				</div>
			</div>
			</fieldset>
			
			
			<fieldset id="step2" class="hidden">
				
			</fieldset>
			</form>
	</div>
	{% endif %}
</div>
<!-- EXPORT IMPORT -->
<style>
	div#checkTab {
	    overflow-y: auto;
	    height: 500px;
	    overflow-x: hidden;
	}
	div#dataTab {
	    overflow-y: auto;
	    height: 500px;
	}
	#dataTab td,#dataTab th{vertical-align: top;text-wrap: nowrap;}
	#dataTab td.active,#dataTab th.active{
		background-color: rgb(169 168 168 / 44%);
		color: #222;
	}
	#dataTab i.fa-folder { color:#dee2e6;}
	tr.striped {
   	 background-color: #efefef;
	}
	#input-filename{
		pointer-events: none;
		background-color: aliceblue;
	}
	
</style>			
<script type="text/javascript">var export_import_alert = window.alert;</script>

<script type="text/javascript"><!--
{% if import %}

$(document).on('click', '#checkTab .form-check-input', function () {
	$('.'+$(this).attr('data-cls')).toggleClass('active')
});

$('#button-upload').on('click', function () {
    var element = this;

    $('#form-upload').remove();

    $('body').prepend('<form enctype="multipart/form-data" id="form-upload" style="display: none;"><input type="file" name="file"/></form>');

    $('#form-upload input[name=\'file\']').trigger('click');

    $('#form-upload input[name=\'file\']').on('change', function () {
        if ((this.files[0].size / 1024) > {{ config_file_max_size }}) {
            $(this).val('');
            alert('{{ error_upload_size }}');
        }
    });

    if (typeof timer !== 'undefined') {
        clearInterval(timer);
    }

    var timer = setInterval(function () {
        if ($('#form-upload input[name=\'file\']').val() !== '') {
            clearInterval(timer);

            $.ajax({
                url: 'index.php?route=bytao/export.uploadf&user_token={{ user_token }}',
                type: 'post',
                dataType: 'json',
                data: new FormData($('#form-upload')[0]),
                cache: false,
                contentType: false,
                processData: false,
                beforeSend: function () {
                    $(element).button('loading');
                },
                complete: function () {
                    $(element).button('reset');
                },
                success: function (json) {
                    if (json['error']) {
                        alert(json['error']);
                    }

                    if (json['content']) {
                    	$('#importTitles').html(json['content']);
                    }
                    
                    if (json['success']) {
                        alert(json['success']);

                        $('#input-filename').val(json['filename']);
                        $('#input-mask').val(json['mask']);
                        $('#button-download').prop('disabled', false);
                    }
                    
                    
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                }
            });
        }
    }, 500);
});

$('#input-filename').on('change', function (e) {
    var value = $(this).val();

    if (value != '') {
        $('#button-download').prop('disabled', false);
    } else {
        $('#button-download').prop('disabled', true);
    }
});

$('#button-download').on('click', function (e) {
    e.preventDefault();
    var element = this;
    $.ajax({
        url: 'index.php?route=bytao/export.uploaded&user_token={{ user_token }}',
        type: 'post',
        dataType: 'json',
        data: $('#import').serialize() + "&filename=" + $('#input-filename').val(),
        beforeSend: function () {
            $(element).button('loading');
        },
        complete: function () {
            $(element).button('reset');
        },
        success: function (json) {
            if (json['content']) {
            	$('#importTitles').html(json['content']);
            }
            
            if (json['success']) {
                alert(json['success']);
            }
            
            
        },
        error: function (xhr, ajaxOptions, thrownError) {
            console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
    });
    //location = 'index.php?route=bytao/export.downloadf&user_token=' + getURLVar('user_token') + '&filename=' + $('#input-filename').val();
});

$(document).on('click','[value="Colors"]',function(){
	if($(this).prop('checked')){
		$('[value="image"]').prop('checked',true)
	}else{
		$('[value="image"]').prop('checked',false)
	}
})

$('#btn-gate').click(function(e) {
    e.preventDefault();
	if (checkFileSize('upload-xls')) {
				$( "html" ).addClass( "loading" );
				var file_data = $('#upload-xls').prop('files')[0];  
				var upload_type = $('#upload-options').val();  
			    var form_data = new FormData();                  
			    form_data.append('upload', file_data);
			    form_data.append('option', upload_type);
			    $.ajax({
			        url: 'index.php?route=bytao/export.upload&user_token={{ user_token }}', 
			        cache: false,
			        contentType: false,
			        processData: false,
			        data: form_data,                         
			        type: 'post',
			        dataType: 'json',
			        beforeSend: function() {
			        	 $( "html" ).addClass( "loading" );
					},
					success: function(json) {
			            if(json['code']) {$('#code').val(json['code']);}
			            if(json['warning']) {alert(json['warning']);}
			            
			            if(json['success'])	{
			            	$('#upload-div').addClass('hidden');
			            	$('#import-gate').html('<i class="fa fa-upload"></i>')
							$('#import-gate').removeClass('btn-success');
							$('#import-gate').addClass('btn-info');	
							$( "html" ).removeClass( "loading" );
							alert(json['success']);
							$('#button-filter').click();
						}
						
			            if(json['error']){
			            		$( "html" ).removeClass( "loading" );
			            		alert(json['error']);
							}
			        },
			        error: function(data, errorThrown)
			          {	
			          		$( "html" ).removeClass( "loading" );
			          		$( ".container-fluid > .panel" ).before( '<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> '+errorThrown+' <button type="button" class="close" data-dismiss="alert">&times;</button></div>' );
			          }
			     });
				}
});

function checkFileSize(id) {
	var input, file, file_size;

	if (!window.FileReader) {
		return true;
	}

	input = document.getElementById(id);
	if (!input) {
		return true;
	}
	else if (!input.files) {
		return true;
	}
	else if (!input.files[0]) {
		alert( "{{ error_select_file }}" );
		return false;
	}
	else 
	{
		file = input.files[0];
		file_size = file.size;
		{% if post_max_size %}
			post_max_size = {{ post_max_size }};
			if (file_size > post_max_size) {
				alert( "{{ error_post_max_size }}" );
				return false;
			}
		{% endif %}
		{% if upload_max_filesize %}
			upload_max_filesize = {{ upload_max_filesize }};
			if (file_size > upload_max_filesize) {
				alert( "{{ error_upload_max_filesize }}" );
				return false;
			}
		{% endif %}
		return true;
	}
}

function isNumber(txt){ 
	var regExp=/^[\d]{1,}$/;
	return regExp.test(txt); 
}

count_product = {{ count_product?count_product:'0' }};
{% endif %}

{% if export %}
function exportData() {
	$('#IDs').val($('#form-{{ ex_type }}').serialize())
	$('#export').submit();
}
{% endif %}

var alert = export_import_alert;

$(document).on("click","#CheckAll",function(){
		
		if($(this).is(':checked')) {
			$("#checkTab .form-check-input").each(function(elem){
				$(this).prop('checked',true);
			});
			$("#Checkimg").prop('checked',true);
		    
		} else {
		   $("#checkTab .form-check-input").each(function(elem){
				$(this).prop('checked',false);
			});
			$("#Checkimg").prop('checked',false);
		}

	});

//--></script>


