{{ header }}{{ column_left }}
<div id="content">
	<div class="art-header">
		<div class="container-fluid">
			<div class="page-ctrl-controls" data-iwidth="" data-owidth=""><a href="{{ add }}" data-bs-toggle="tooltip" title="{{ button_add }}" class="btn btn-primary"><i class="fa-solid fa-plus"></i></a>
				{% if ADM=='1'%}
				<button type="submit" form="form-art" formaction="{{ delete }}" data-bs-toggle="tooltip" title="{{ button_delete }}" onclick="return confirm('{{ text_confirm }}');" class="btn btn-danger"><i class="fa-regular fa-trash-can"></i></button>
				{% endif %}
			</div>
			<h1>{{ heading_title }}</h1>
			<ol class="breadcrumb">
				{% for breadcrumb in breadcrumbs %}
					<li class="breadcrumb-item"><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
				{% endfor %}
			</ol>
		</div>
	</div>
	<div class="container-fluid">
		<div class="row">
      <div id="filter-art" class="col-lg-3 col-md-12 order-lg-last d-none d-lg-block mb-3">
        <div class="card">
          <div class="card-header"><i class="fa-solid fa-filter"></i> {{ text_filter }}</div>
          <div class="card-body">
            <div class="mb-3">
              <label for="input-name" class="form-label">{{ entry_name }}</label>
              <input type="text" name="filter_name" value="{{ filter_name }}" placeholder="{{ entry_name }}" id="input-name" data-oc-target="autocomplete-name" class="form-control" autocomplete="off"/>
              <ul id="autocomplete-name" class="dropdown-menu"></ul>
            </div>
            <div class="mb-3">
              <label for="input-code" class="form-label">{{ entry_code }}</label>
              <input type="text" name="filter_code" value="{{ filter_code }}" placeholder="{{ entry_code }}" id="input-code" data-oc-target="autocomplete-code" class="form-control" autocomplete="off"/>
              <ul id="autocomplete-code" class="dropdown-menu"></ul>
            </div>
            <div class="mb-3">
              <label for="input-category" class="form-label">{{ entry_category }}</label> <select name="filter_category" id="input-category" class="form-select">
                <option value=""></option>
                {% for category in artcategories %}
                	<option value="{{ category.category_id  }}"{% if filter_category == category.category_id %} selected{% endif %}>{{ category.name }}</option>
                {% endfor %}
              </select>
            </div>
            
            <div class="mb-3">
            	<div class="input-group row">
	            	<label for="input-status" class="form-label col-sm-7">{{ text_item_status }}</label> 
	            	<div class="form-check form-switch form-switch-lg col-sm-3" style="">
	                        <input type="checkbox" name="filter_status" value="1" id="input-status" class="form-check-input"{% if filter_status %} checked{% endif %}/>
	                </div>
                </div>
            </div>

             <div class="mb-3">
              <div class="input-group row">
              	<label for="input-all" class="form-label col-sm-7">{{ entry_pagination }}</label>
                <div class="form-check form-switch form-switch-lg col-sm-3" style="">
                   <input type="checkbox" name="filter_all" value="1" id="input-all" class="form-check-input"{% if filter_all %} checked{% endif %}/>
                </div>
            </div>
            </div>
            
            <div class="text-end">
              <button type="button" id="button-filter" class="btn btn-light"><i class="fa-solid fa-filter"></i> {{ button_filter }}</button>
            </div>
          </div>
        </div>
      </div>
      <div class="col col-lg-9 col-md-12">
        <div class="card">
          <div class="card-header list-header"><i class="fa-solid fa-list"></i> {{ text_list }}</div>
          <div id="art" class="card-body">{{ list }}</div>
        </div>
      </div>
    </div>
	</div>
</div>
<script type="text/javascript"><!--
var Sorty;
$('#art').on('click', 'thead a, .pagination a', function (e) {
    e.preventDefault();

    $('#art').load(this.href);
});

$('#button-filter').on('click', function () {
    var url = '';

    var filter_name = $('#input-name').val();
    if (filter_name) {
        url += '&filter_name=' + encodeURIComponent(filter_name);
    }

	var filter_code = $('#input-code').val();
    if (filter_code) {
        url += '&filter_code=' + encodeURIComponent(filter_code);
    }
	
	var filter_all = $('#input-all').prop( "checked" )
    if (filter_all) {
        url += '&filter_all=1';
    }

    var filter_status = $('#input-status').prop("checked");
    if (filter_status) {
        url += '&filter_status=1';
    }
    
    var filter_category = $('#input-category').val();
    if (filter_category !== '') {
        url += '&filter_category=' + filter_category;
    }

    $('#art').load('index.php?route=bytao/art.list&user_token={{ user_token }}' + url,function(){
    	//$( "#sortable" ).sortable( "refresh" );
    	if (filter_category !== '' && filter_all && !filter_name && !filter_code) {
    		if(!$('.list-header > .fa-people-carry').length){
    			$('.fa-list').before('<i class="fa red fa-people-carry"></i> ')
    		}
    		
    		$( "#sortable" ).addClass('sortable-results')
    		$( "#sortable" ).sortable({disabled: false});
    	}else{
    		$('.list-header > .fa-people-carry').remove();
    		$( "#sortable" ).removeClass('sortable-results')
    		$( "#sortable" ).sortable({disabled: true});
    	}
    	
    });
    
   
});

$( "#sortable" ).sortable({
  handle: ".carry",
  cancel: ".portlet-toggle",
  helper: "clone",
  opacity: 0.5,
  revert: true,
  scroll: true,
  tolerance: "pointer",
  containment: "#sortableDiv",
  //placeholder: "portlet-placeholder ui-corner-all",
  classes: {"ui-sortable": "highlight"},
  change: function( event, ui ) {},
  stop: function( event, ui ) {
  		var c = $( "#sortable" ).sortable( "toArray" );
  		
  		//var sortedIDs = $(".column").sortable("serialize").get().join("\n");
  		$.ajax({
				url: 'index.php?route=bytao/art.sortorder&user_token={{ user_token }}&serial='+c+'&cat_id='+filter_category,
				dataType: 'json',			
				success: function(json) {
					$('.close').show();
					$('.process').hide();
				}
			});
  	}
});

$( "#sortable" ).sortable({disabled: true});

$(document).ready(function(){
	var goTO = $('form[data-oc-go]').attr('data-oc-go');
    if (goTO !== undefined && goTO !='') {
        $('html, body').animate({
            scrollTop: $("#"+goTO).offset().top
        }, 1000);
	}
		
	{% if filter_category and filter_all %}
	$( "#selector" ).sortable({disabled: false});
	{% endif %}
});

$('#input-code').autocomplete({
    'source': function (request, response) {
    	var filter_category = $('#input-category').val();
    	if(filter_category){
    		URL='index.php?route=bytao/art.autocomplete&user_token={{ user_token }}&filter_category='+ filter_category +'&filter_code=' + encodeURIComponent(request);
    	}else{
    		URL='index.php?route=bytao/art.autocomplete&user_token={{ user_token }}&filter_code=' + encodeURIComponent(request);
    	}
        $.ajax({
            url: URL,
            dataType: 'json',
            success: function (json) {
                response($.map(json, function (item) {
                    return {
                        label: item['name'],
                        value: item['value']
                    }
                }));
            }
        });
    },
    'select': function (item) {
        $('#input-code').val(item['label']);
    }
});
$('#input-name').autocomplete({
    'source': function (request, response) {
    	var filter_category = $('#input-category').val();
    	if(filter_category){
    		URL='index.php?route=bytao/art.autocomplete&user_token={{ user_token }}&filter_category='+filter_category +'&filter_name=' + encodeURIComponent(request);
    	}else{
    		URL='index.php?route=bytao/art.autocomplete&user_token={{ user_token }}&filter_name=' + encodeURIComponent(request);
    	}
        $.ajax({
            url: URL,
            dataType: 'json',
            success: function (json) {
                response($.map(json, function (item) {
                    return {
                        label: item['name'],
                        value: item['value']
                    }
                }));
            }
        });
    },
    'select': function (item) {
        $('#input-name').val(item['label']);
    }
});

//--></script>
{{ footer }}